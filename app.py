import streamlit as st
import pandas as pd
from datetime import datetime
import os

st.set_page_config(page_title="BMRQ éŸ³ä¹å¥–èµé—®å·", layout="centered")

st.title("ğŸµ BMRQ éŸ³ä¹å¥–èµæ•æ„Ÿæ€§é—®å·")
st.write("è¯·å¯¹æ¯ä¸ªé™ˆè¿°é€‰æ‹©æ‚¨åŒæ„ç¨‹åº¦ï¼ˆ1=å®Œå…¨ä¸åŒæ„ï¼Œ5=å®Œå…¨åŒæ„ï¼‰ã€‚æäº¤åä¼šæ˜¾ç¤ºæ€»åˆ†ä¸åˆ¤å®šç»“æœã€‚")

questions = [
    "å½“æˆ‘ä¸ä»–äººåˆ†äº«éŸ³ä¹æ—¶ï¼Œæˆ‘ä¼šæ„Ÿè§‰ä¸é‚£ä¸ªäººæœ‰ä¸€ç§ç‰¹åˆ«çš„è”ç³»ã€‚",
    "åœ¨ç©ºé—²æ—¶é—´æˆ‘å‡ ä¹ä¸å¬éŸ³ä¹ã€‚",
    "æˆ‘å–œæ¬¢è†å¬å¯Œå«æƒ…æ„Ÿçš„éŸ³ä¹ã€‚",
    "å½“æˆ‘ç‹¬å¤„æ—¶ï¼ŒéŸ³ä¹ä¼šé™ªä¼´æˆ‘ã€‚",
    "æˆ‘ä¸å–œæ¬¢è·³èˆï¼Œå³ä½¿é…ä¸Šæˆ‘å–œæ¬¢çš„éŸ³ä¹ä¹Ÿä¸å–œæ¬¢ã€‚",
    "éŸ³ä¹è®©æˆ‘ä¸ä»–äººæ›´åŠ äº²è¿‘ã€‚",
    "æˆ‘ä¼šä¸»åŠ¨äº†è§£æˆ‘å–œæ¬¢çš„éŸ³ä¹èµ„è®¯ã€‚",
    "å¬åˆ°æŸäº›éŸ³ä¹ä½œå“æ—¶æˆ‘ä¼šäº§ç”Ÿå¼ºçƒˆæƒ…æ„Ÿã€‚",
    "éŸ³ä¹èƒ½è®©æˆ‘å¹³é™ã€æ”¾æ¾ã€‚",
    "éŸ³ä¹ç»å¸¸è®©æˆ‘æƒ³è·³èˆã€‚",
    "æˆ‘æ€»æ˜¯åœ¨å¯»æ‰¾æ–°çš„éŸ³ä¹ã€‚",
    "å½“æˆ‘å¬åˆ°ç‰¹åˆ«å–œæ¬¢çš„æ—‹å¾‹æ—¶ï¼Œä¼šçœ¼çœ¶æ¹¿æ¶¦ç”šè‡³è½æ³ªã€‚",
    "æˆ‘å–œæ¬¢ä¸ä»–äººä¸€èµ·å”±æ­Œæˆ–åˆå¥ã€‚",
    "éŸ³ä¹æœ‰åŠ©äºè®©æˆ‘æ”¾æ¾è§£å‹ã€‚",
    "å¬åˆ°å–œæ¬¢çš„éŸ³ä¹æ—¶æˆ‘ä¼šæƒ…ä¸è‡ªç¦åœ°å“¼å”±æˆ–è·Ÿå”±ã€‚",
    "åœ¨éŸ³ä¹ä¼šä¸­ï¼Œæˆ‘ä¼šæ„Ÿåˆ°ä¸æ¼”å¥è€…å’Œè§‚ä¼—å½¼æ­¤ç›¸è¿ã€‚",
    "æˆ‘ä¼šåœ¨éŸ³ä¹åŠç›¸å…³ç‰©å“ä¸ŠèŠ±è´¹ä¸å°‘é’±ã€‚",
    "å¬åˆ°å–œæ¬¢çš„æ—‹å¾‹æ—¶ï¼Œæˆ‘æœ‰æ—¶ä¼šèµ·é¸¡çš®ç–™ç˜©ã€‚",
    "éŸ³ä¹èƒ½å®‰æ…°æˆ‘ã€‚",
    "å¬åˆ°éå¸¸å–œæ¬¢çš„æ›²å­æ—¶ï¼Œæˆ‘ä¼šæƒ…ä¸è‡ªç¦åœ°éšç€èŠ‚æ‹æ‰“æ‹æˆ–æ‘†åŠ¨ã€‚"
]

scale = ["1", "2", "3", "4", "5"]

with st.form("bmrq_form", clear_on_submit=False):
    name = st.text_input("å¯é€‰ï¼šå—è¯•è€…æ ‡è¯†ï¼ˆå§“å/ç¼–å·ï¼‰")
    responses = []
    for i, q in enumerate(questions):
        st.write(f"**{i+1}. {q}**")
        val = st.radio(
            label=f"q{i}",
            options=scale,
            index=None,
            horizontal=True,
            key=f"q{i}"
        )
        responses.append(val)

    submitted = st.form_submit_button("æäº¤é—®å·å¹¶æŸ¥çœ‹ç»“æœ")

if submitted:
    if any(v is None for v in responses):
        st.warning("è¿˜æœ‰é¢˜ç›®æœªä½œç­”å“¦ï½è¯·å®Œæˆå…¨éƒ¨é¢˜ç›®å†æäº¤ã€‚")
    else:
        scores = [int(v) for v in responses]
        total = sum(scores)
        st.subheader(f"æ€»åˆ†ï¼š{total} / 100")
        if total > 65:
            st.success("ğŸ‰ ç»“æœï¼šé€šè¿‡ï¼ˆéŸ³ä¹å¥–èµæ•æ„Ÿæ€§æ­£å¸¸ï¼‰")
        else:
            st.error("âš ï¸ ç»“æœï¼šåˆ†æ•°â‰¤65ï¼Œæç¤ºå¥–èµæ•æ„Ÿæ€§è¾ƒä½")

        # â€”â€” ä¿å­˜ç»“æœï¼ˆç®€å• CSV æœ¬åœ°ï¼›ç”Ÿäº§å»ºè®®ç”¨äº‘ç«¯è¡¨æ ¼ï¼‰â€”â€”
        row = {
            "timestamp": datetime.utcnow().isoformat(),
            "name": name,
            **{f"Q{i+1}": s for i, s in enumerate(scores)},
            "total": total
        }
        os.makedirs("results", exist_ok=True)
        csv_path = "results/bmrq_results.csv"
        df = pd.DataFrame([row])
        header = not os.path.exists(csv_path)
        df.to_csv(csv_path, mode="a", header=header, index=False)
        st.caption("ç»“æœå·²ä¿å­˜ï¼ˆå½“å‰ä¸ºåº”ç”¨å®¹å™¨æœ¬åœ° CSVï¼Œæ¢ç‰ˆæœ¬æˆ–é‡å¯ä¼šæ¸…ç©ºï¼Œå»ºè®®è§ä¸‹æ–‡é‡‡ç”¨äº‘ç«¯æŒä¹…åŒ–ï¼‰ã€‚")
